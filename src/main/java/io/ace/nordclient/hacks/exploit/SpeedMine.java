package io.ace.nordclient.hacks.exploit;

import io.ace.nordclient.CousinWare;
import io.ace.nordclient.event.EventPlayerDamageBlock;
import io.ace.nordclient.event.EventPlayerResetBlockRemoving;
import io.ace.nordclient.hacks.Hack;
import io.ace.nordclient.utilz.Setting;
import net.minecraft.block.Block;
import net.minecraft.block.state.IBlockState;
import net.minecraft.client.Minecraft;
import net.minecraft.network.play.client.CPacketPlayerDigging;
import net.minecraft.util.math.BlockPos;
import team.stiff.pomelo.impl.annotated.handler.annotation.Listener;

import java.util.ArrayList;

public class SpeedMine extends Hack {

    Setting onlyPic;
    Setting mode;

    public SpeedMine() {
        super("SpeedMine", Category.EXPLOIT, 15763555);
        CousinWare.INSTANCE.settingsManager.rSetting(onlyPic = new Setting("OnlyPic", this, true, "SpeedMineOnlyPic"));

        ArrayList<String> modes = new ArrayList<>();
        modes.add("Packet");
        modes.add("Insta");
        modes.add("Damage");
        modes.add("Instant");
        CousinWare.INSTANCE.settingsManager.rSetting(mode = new Setting("Mode", this, "Packet", modes, "SpeedMineMode"));

    }

    @Listener
    public void damageBlock(EventPlayerDamageBlock event) {
        if (canBreak(event.getPos())) {
            BlockPos lastDamageBlock;
            if (mode.getValString().equalsIgnoreCase("Packet")) {
                mc.player.connection.sendPacket(new CPacketPlayerDigging(CPacketPlayerDigging.Action.START_DESTROY_BLOCK, event.getPos(), event.getDirection()));
                mc.player.connection.sendPacket(new CPacketPlayerDigging(CPacketPlayerDigging.Action.STOP_DESTROY_BLOCK, event.getPos(), event.getDirection()));

            }
            if (mode.getValString().equalsIgnoreCase("Insta")) {
                mc.player.connection.sendPacket(new CPacketPlayerDigging(CPacketPlayerDigging.Action.STOP_DESTROY_BLOCK, event.getPos(), event.getDirection()));

            }
        }
    }

    @Listener
    public void setReset(EventPlayerResetBlockRemoving event) {
        if (mode.getValString().equalsIgnoreCase("Insta")) {

        }
    }

    private boolean canBreak(BlockPos pos) {
        final IBlockState blockState = mc.world.getBlockState(pos);
        final Block block = blockState.getBlock();

        return block.getBlockHardness(blockState, Minecraft.getMinecraft().world, pos) != -1;
    }
}
