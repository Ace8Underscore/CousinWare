package io.ace.nordclient.hacks.exploit;

import io.ace.nordclient.CousinWare;
import io.ace.nordclient.event.PacketEvent;
import io.ace.nordclient.hacks.Hack;
import io.ace.nordclient.mixin.accessor.ISPacketEntityVelocity;
import io.ace.nordclient.utilz.MathUtil;
import io.ace.nordclient.utilz.Setting;
import net.minecraft.network.play.server.SPacketEntityVelocity;
import team.stiff.pomelo.impl.annotated.handler.annotation.Listener;

public class NoSlowBypass extends Hack {

    Setting reduction;
    Setting velocityUse;

    public NoSlowBypass() {
        super("Boost", Category.MOVEMENT, 11780793);
        CousinWare.INSTANCE.settingsManager.rSetting(reduction = new Setting("Reduction", this, 2, 1, 1000,false, "StrafeBoost"));
        CousinWare.INSTANCE.settingsManager.rSetting(velocityUse = new Setting("StartBoost", this, 50000, 0, 100000,false, "StrafeBoost"));

    }

    int velocity = 0;

    @Override
    public void onUpdate() {
    if (velocity > velocityUse.getValInt()) {
        final double[] dir = MathUtil.directionSpeed(velocity / 8000);
        mc.player.setVelocity((dir[0] / 2) / reduction.getValDouble(), 0, (dir[1] / 2) / reduction.getValDouble());
        velocity = 0;
        }
    }

    @Listener
    public void onUpdate(PacketEvent.Receive event) {
        if (event.getPacket() instanceof SPacketEntityVelocity) {
            if (((SPacketEntityVelocity) event.getPacket() == null)) return;
            if(((SPacketEntityVelocity) event.getPacket()).getEntityID() == mc.player.getEntityId()) {
                int vX = ((ISPacketEntityVelocity) event.getPacket()).getMotionX();
                int vY = ((ISPacketEntityVelocity) event.getPacket()).getMotionY();
                int vZ = ((ISPacketEntityVelocity) event.getPacket()).getMotionZ();
                if (vX < 0) vX *= -1;
                if (vY < 0) vY *= -1;
                if (vZ < 0) vZ *= -1;
                velocity += vX + vY + vZ;


            }
        }
    }


}
